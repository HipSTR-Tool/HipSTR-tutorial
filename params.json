{
  "name": "Hipstr-tutorial",
  "tagline": "Simple tutorial demonstrating how to run HipSTR with human WGS data",
  "body": "# HipSTR-tutorial\r\nSimple tutorial demonstrating how to run HipSTR with human WGS data and interpret the output\r\n\r\n## Introduction\r\nIn this tutorial, we'll be genotyping 599 STRs that are part of the Marshfield panel of markers. These markers are some of the most polymorphic STRs in the human genome. We'll be using whole-genome sequencing data for NA12878, NA12891 and NA12892, a [trio](https://catalog.coriell.org/0/Sections/Collections/NIGMS/CEPHFamiliesDetail.aspx?PgId=441&fam=1463&) of individuals that is widely analyzed in genomics.\r\n\r\n## Getting setup\r\n\r\nFirst, download this repository and all of its files from github\r\n\r\n    git clone https://github.com/HipSTR-Tool/HipSTR-tutorial.git\r\n    cd HipSTR-tutorial\r\n\r\nNext, let's download HipSTR from github and build it: \r\n\r\n    git clone --recursive https://github.com/tfwillems/HipSTR.git\r\n    cd HipSTR\r\n    make\r\n    cd ../\r\n    \r\nThe last source of input we'll need are FASTA files for the human genome.\r\nSince our BAM alignments are relative to the hg19 reference genome, we'll\r\ndownload this version of the human reference:\r\n\r\n    mkdir fasta\r\n    cd fasta\r\n    wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/bigZips/chromFa.tar.gz\r\n    tar -xzvf chromFa.tar.gz\r\n    cd ../\r\n\r\n## Input files\r\nIn the tutorial directory, we've provided a **regions.bed** file that contains the required information about each STR. Each line in the BED file contains the chromosomal positions of an STR, its period, the number of repeat copies and it's name:\r\n\r\n    head -n 5 regions.bed\r\n    \r\n```\r\nchr1\t6464771\t6464818\t4\t12\tMFD424-TTTA003\r\nchr1\t7142501\t7142552\t4\t13\tGATA23G09\r\nchr1\t10987588\t10987617\t3\t10\tAAT238\r\nchr1\t13784267\t13784306\t4\t10\tGATA27E01\r\nchr1\t16540224\t16540267\t4\t11\tTTTA063\r\n```\r\n\r\nWe've also provided sorted and indexed BAM files in **bams/** that were prefiltered to save space. These files only contain reads and their mate pairs that overlap the STRs we're interested in. \r\n\r\nLet's take a look at the sample information in these BAMs:\r\n\r\n    for file in bams/*.bam; do samtools view -H $file | grep @RG; done\r\n\r\n```\r\n@RG\tID:ERR194147\tLB:ERR194147\tPL:Illumina\tSM:NA12878\tPU:ERR194147\r\n@RG\tID:ERR194160\tLB:ERR194160\tPL:Illumina\tSM:NA12891\tPU:ERR194160\r\n@RG\tID:ERR194161\tLB:ERR194161\tPL:Illumina\tSM:NA12892\tPU:ERR194161\r\n@RG\tID:SRR826427\tLB:SRR826427\tPL:Illumina\tSM:NA12891\tPU:SRR826427\r\n@RG\tID:SRR826428\tLB:SRR826428\tPL:Illumina\tSM:NA12892\tPU:SRR826428\r\n@RG\tID:SRR826448\tLB:SRR826448\tPL:Illumina\tSM:NA12891\tPU:SRR826448\r\n@RG\tID:SRR826463\tLB:SRR826463\tPL:Illumina\tSM:NA12878\tPU:SRR826463\r\n@RG\tID:SRR826465\tLB:SRR826465\tPL:Illumina\tSM:NA12891\tPU:SRR826465\r\n@RG\tID:SRR826467\tLB:SRR826467\tPL:Illumina\tSM:NA12878\tPU:SRR826467\r\n@RG\tID:SRR826469\tLB:SRR826469\tPL:Illumina\tSM:NA12878\tPU:SRR826469\r\n@RG\tID:SRR826471\tLB:SRR826471\tPL:Illumina\tSM:NA12892\tPU:SRR826471\r\n@RG\tID:SRR826473\tLB:SRR826473\tPL:Illumina\tSM:NA12892\tPU:SRR826473\r\n```\r\nEach of the 12 BAM files has a single read group, corresponding to 1 of 3 samples: NA12878, NA12891 or NA12892. HipSTR uses the **SM** tags to determine what sample each read comes from and uses the **LB** tag to determine what sequencing library each read comes from.\r\n\r\n## Running HipSTR\r\nNow that we have the required input files, let's run HipSTR. We can analyze all of the BAMs jointly to genotype all 3 samples at the 599 STRs as follows:\r\n\r\n```\r\n./HipSTR --bams      bams/ERR194147.bam,bams/ERR194160.bam,bams/ERR194161.bam,bams/SRR826427.bam,bams/SRR826428.bam,bams/SRR826448.bam,bams/SRR826463.bam,bams/SRR826465.bam,bams/SRR826467.bam,bams/SRR826469.bam,bams/SRR826471.bam,bams/SRR826473.bam\r\n         --fasta     fasta/\r\n         --regions   regions.bed\r\n         --str-vcf   trio.marshfield.no_snps.vcf.gz\r\n         --log       trio.marshfield.no_snps.log\r\n         --viz-out   trio.marshfield.no_snps.html.gz\r\n         --min-reads 25 --def-stutter-model --read-qual-trim \\#\r\n```\r\nThis will generate a bgzipped VCF file (*trio.marshfield.no_snps.vcf.gz*) containing STR genotypes, as well as a bgzipped HTML file (*trio.marshfield.no_snps.html.gz*) we'll later use to visualize the results. On a standard CPU, this should take 2-3 minutes to run. \r\n\r\n\r\n## Interpreting HipSTR's output\r\nTo help understand HipSTR's output, lets examine the VCF information for STR named GATA27E01. If you recall from above, GATA27E01 has the following information our region file: \r\n\r\n    chr1\t13784267\t13784306\t4\t10\tGATA27E01\r\n\r\nWe'll use [VCFTools](https://vcftools.github.io/man_latest.html) to extract the information for this STR from our VCF file and we'll then use [datamash](https://www.gnu.org/software/datamash/) to convert each column into its own line:\r\n\r\n    vcftools --gzvcf trio.marshfield.no_snps.vcf.gz --snp GATA27E01 --recode --recode-INFO-all --stdout | tail -n 2 | datamash transpose\r\nThis produces output that looks something like the following:\r\n```\r\n#CHROM\tchr1\r\nPOS\t13784267\r\nID\tGATA27E01\r\nREF\tGATAGATAGATAGATAGATAGATAGATAGATAGATAGATA\r\nALT\tGATAGATAGATAGATAGATAGATAGATA,GATAGATAGATAGATAGATAGATAGATAGATA,GATAGATAGATAGATAGATAGATAGATAGATAGATAGATAGATA\r\nQUAL\t.\r\nFILTER\t.\r\nINFO\tINFRAME_PGEOM=0.950;INFRAME_UP=0.050;INFRAME_DOWN=0.050;OUTFRAME_PGEOM=0.950;OUTFRAME_UP=0.010;OUTFRAME_DOWN=0.010;START=13784267;END=13784306;PERIOD=4;NSKIP=0;NFILT=0;BPDIFFS=-12,-8,4;DP=230;DSNP=0;DFILT=0;DSTUTTER=1;DFLANKINDEL=1;AN=6;REFAC=1;AC=1,2,2\r\nFORMAT\tGT:GB:Q:PQ:DP:DSNP:DFILT:DSTUTTER:DFLANKINDEL:PDP:PSNP:BPDOSE:GLDIFF:BQ:ALLREADS:MALLREADS\r\nNA12878\t2|3:-8|4:1.000:0.500:84:0:0:0:0:41.000|43.000:0|0:-4.000:52.318:1.000:-999|14;-8|31;4|39:-8|37;4|39\r\nNA12891\t0|3:0|4:1.000:0.500:64:0:0:1:1:30.426|33.574:0|0:4.000:21.905:1.000:-999|9;0|28;4|27:0|27;4|27;8|1\r\nNA12892\t1|2:-12|-8:1.000:0.500:82:0:0:0:0:40.039|41.961:0|0:-20.000:27.724:1.000:-999|9;-12|34;-8|39:-12|38;-8|41\r\n```\r\nWhat does this tell us?\r\n\r\n1. HipSTR detected 3 additional present alleles (ALT) that are -12, -8 and +4 bp in length relative to the ref allele (INFO:BPDIFFS).\r\n2. The genotype (GT) for NA12891 suggests that he carries the ref allele and a 4 bp insertion, with high confidence (Q=1.0=100% posterior)\r\n3. The genotype (GT) for NA12892 suggests that she carries a 12 bp deletion and an 8 bp deletion, with high confidence (Q=1.0)\r\n4. The genotype (GT) for NA12878 suggests that she carries an 8 bp deletion and a 4 bp insertion, with high confidence (Q=1.0)\r\n5. None of the genotypes are phased (PQ=0.5) because HipSTR was not run with the --snp-vcf option and no samples have phase-informative reads (DSNP=0)\r\n6. There are very few reads with stutter artifacts (DSTUTTER = 0, 1, and 0 for NA12878, NA12891 and NA12892)\r\n7. There are very few reads with indels in the flanking sequences (DFLANKINDEL = 0, 1, and 0 for NA12878, NA12891 and NA12892)\r\n8. The high posterior confidences (Q), combined with the low stutter and flanking indel frequencies, make us very confident in the reported genotypes!\r\n\r\nThis is great, but what is HipSTR doing under the hood? And how can we visualize these results to gain confidence? \r\n\r\nBelow, we'll use the output from the **--viz-out** HipSTR option (*trio.marshfield.no_snps.html.gz*) and a tool provided in the HipSTR directory called **VizAlnPdf**. This tool analyzes the html file to generate PDFs of HipSTR's maximum-likelihood (ML) alignments. These ML alignments indicate the arrangement of all of a sample's reads relative to its ML genotype. Before we can do so, we need to index the HTML file using [tabix](http://www.htslib.org/doc/tabix.html):\r\n\r\n    tabix -p vcf trio.marshfield.no_snps.html.gz\r\n\r\n###NA12891\r\nVisualizing the maximum likelihood alignments for NA12891 is easy: \r\n    \r\n    HipSTR/VizAlnPdf trio.marshfield.no_snps.html.gz chr1 13784267 viz_NA12891 3\r\nThis will generate a PDF file *viz_NA12891.pdf* containing maximum likelihood alignments for every *3*rd read.\r\n![NA12891!](https://raw.githubusercontent.com/HipSTR-Tool/HipSTR-tutorial/master/viz_NA12891.png)\r\nThe first group of reads provides strong support for the reference allele in this sample. The second group of reads, which contain insertions highlighted in red, stronly support the +4 bp allele. Internally, HipSTR disentangles which read belongs to each haplotype as is diplayed in the PDF.\r\n###NA12892\r\nViewining the alignments for NA12892 is just as easy:\r\n\r\n    HipSTR/VizAlnPdf trio.marshfield.no_snps.html.gz chr1 13784267 viz_NA12892 3\r\n![NA12891!](https://raw.githubusercontent.com/HipSTR-Tool/HipSTR-tutorial/master/viz_NA12892.png)\r\nWe again see that the reads strongly support the -12/-8 genotype determined for this sample\r\n###NA12878\r\nLastly, we can visualize NA12878's maximum likelihood alignments:\r\n\r\n    HipSTR/VizAlnPdf trio.marshfield.no_snps.html.gz chr1 13784267 viz_NA12878 3\r\n\r\n![NA12891!](https://raw.githubusercontent.com/HipSTR-Tool/HipSTR-tutorial/master/viz_NA12878.png)\r\nThe first group of reads support the -8bp allele, while the second groups supports the +4bp allele.\r\n\r\nIn summary, **VizAlnPdf** provides a powerful way to interpret HipSTR's output and gain confidence in corresponding genotypes.\r\n\r\n## Conclusion\r\nThis tutorial provided a brief overview of how to run HipSTR on a simple dataset and interpret the results. For more information, please refer to the main HipSTR [page](https://hipstr-tool.github.io/HipSTR/) or send questions or issues to hipstrtool@gmail.edu  \r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}